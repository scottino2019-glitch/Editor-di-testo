<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìù Editor di Testo Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .document-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .toolbar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 0 10px;
            border-right: 1px solid #dee2e6;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .tool-btn {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 40px;
            justify-content: center;
        }

        .tool-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .tool-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .font-select, .size-select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }

        .color-input {
            width: 40px;
            height: 35px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            background: none;
        }

        .editor-container {
            padding: 30px;
            min-height: 600px;
        }

        .page {
            background: white;
            min-height: 800px;
            padding: 60px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 8px;
            position: relative;
        }

        .editor {
            width: 100%;
            min-height: 680px;
            border: none;
            outline: none;
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            resize: none;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 10px 30px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
        }

        .word-count {
            display: flex;
            gap: 20px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-buttons .btn {
            flex: 1;
            background: #667eea;
            color: white;
            border-radius: 8px;
        }

        .modal-buttons .btn.secondary {
            background: #6c757d;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .document-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .document-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .document-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            word-break: break-word;
        }

        .document-preview {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            height: 40px;
            overflow: hidden;
            line-height: 1.4;
        }

        .document-date {
            font-size: 11px;
            color: #adb5bd;
        }

        .document-delete {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }

        .find-replace-bar {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px 30px;
            display: none;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .find-replace-bar.show {
            display: flex;
        }

        .find-input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            min-width: 120px;
            flex: 1;
            max-width: 200px;
        }

        .find-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
        }

        .find-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .template-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .template-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .template-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .template-description {
            font-size: 12px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .toolbar {
                padding: 10px 15px;
            }
            
            .toolbar-group {
                padding: 0 5px;
            }
            
            .page {
                padding: 30px 20px;
            }
            
            .editor-container {
                padding: 15px;
            }

            .find-replace-bar {
                padding: 10px 15px;
                gap: 8px;
            }

            .find-input {
                min-width: 100px;
                font-size: 16px; /* Previene zoom su iOS */
            }

            .find-buttons .btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .find-controls {
                gap: 8px;
            }

            .header {
                padding: 15px 20px;
            }

            .document-actions {
                gap: 8px;
            }

            .btn {
                padding: 8px 15px;
                font-size: 12px;
            }
        }

        /* Stili per il testo formattato */
        .editor b, .editor strong { font-weight: bold; }
        .editor i, .editor em { font-style: italic; }
        .editor u { text-decoration: underline; }
        .editor s { text-decoration: line-through; }
        .editor h1 { font-size: 2.5em; font-weight: bold; margin: 0.5em 0; color: #333; }
        .editor h2 { font-size: 2em; font-weight: bold; margin: 0.5em 0; color: #444; }
        .editor h3 { font-size: 1.5em; font-weight: bold; margin: 0.5em 0; color: #555; }
        .editor ul { margin: 1em 0; padding-left: 2em; }
        .editor ol { margin: 1em 0; padding-left: 2em; }
        .editor li { margin: 0.2em 0; }
        .editor blockquote { 
            margin: 1em 0; 
            padding: 0.5em 1em; 
            border-left: 4px solid #667eea; 
            background: #f8f9fa; 
            font-style: italic; 
        }

        /* Evidenziazione ricerca */
        .highlight {
            background-color: #ffeb3b !important;
            color: #000 !important;
        }

        .current-highlight {
            background-color: #ff9800 !important;
            color: #fff !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <span>üìù</span>
                Editor di Testo Pro
            </div>
            <div class="document-actions">
                <button class="btn" onclick="newDocument()">üìÑ Nuovo</button>
                <button class="btn" onclick="saveDocument()">üíæ Salva</button>
                <button class="btn" onclick="loadDocuments()">üìÅ Apri</button>
                <button class="btn" onclick="exportDocument()">üì§ Esporta</button>
                <button class="btn" onclick="printDocument()">üñ®Ô∏è Stampa</button>
            </div>
        </div>

        <div class="toolbar">
            <div class="toolbar-group">
                <select class="font-select" id="fontFamily" onchange="changeFont()">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Courier New">Courier New</option>
                </select>
                <select class="size-select" id="fontSize" onchange="changeFontSize()">
                    <option value="12">12</option>
                    <option value="14">14</option>
                    <option value="16" selected>16</option>
                    <option value="18">18</option>
                    <option value="20">20</option>
                    <option value="24">24</option>
                    <option value="28">28</option>
                    <option value="32">32</option>
                    <option value="36">36</option>
                </select>
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="formatText('bold')" title="Grassetto">
                    <strong>B</strong>
                </button>
                <button class="tool-btn" onclick="formatText('italic')" title="Corsivo">
                    <em>I</em>
                </button>
                <button class="tool-btn" onclick="formatText('underline')" title="Sottolineato">
                    <u>U</u>
                </button>
                <button class="tool-btn" onclick="formatText('strikeThrough')" title="Barrato">
                    <s>S</s>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="formatText('justifyLeft')" title="Allinea a sinistra">
                    ‚¨ÖÔ∏è
                </button>
                <button class="tool-btn" onclick="formatText('justifyCenter')" title="Centra">
                    ‚ÜîÔ∏è
                </button>
                <button class="tool-btn" onclick="formatText('justifyRight')" title="Allinea a destra">
                    ‚û°Ô∏è
                </button>
                <button class="tool-btn" onclick="formatText('justifyFull')" title="Giustifica">
                    ‚¨å
                </button>
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="formatText('insertUnorderedList')" title="Elenco puntato">
                    ‚Ä¢ Lista
                </button>
                <button class="tool-btn" onclick="formatText('insertOrderedList')" title="Elenco numerato">
                    1. Lista
                </button>
                <button class="tool-btn" onclick="formatText('outdent')" title="Riduci rientro">
                    ‚¨Ö
                </button>
                <button class="tool-btn" onclick="formatText('indent')" title="Aumenta rientro">
                    ‚û°
                </button>
            </div>

            <div class="toolbar-group">
                <input type="color" class="color-input" id="textColor" onchange="changeTextColor()" title="Colore testo" value="#000000">
                <input type="color" class="color-input" id="bgColor" onchange="changeBackgroundColor()" title="Colore sfondo" value="#ffffff">
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="insertHeading(1)" title="Titolo 1">
                    H1
                </button>
                <button class="tool-btn" onclick="insertHeading(2)" title="Titolo 2">
                    H2
                </button>
                <button class="tool-btn" onclick="insertHeading(3)" title="Titolo 3">
                    H3
                </button>
                <button class="tool-btn" onclick="insertQuote()" title="Citazione">
                    üí¨
                </button>
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="insertLink()" title="Inserisci link">
                    üîó
                </button>
                <button class="tool-btn" onclick="insertImage()" title="Inserisci immagine">
                    üñºÔ∏è
                </button>
                <button class="tool-btn" onclick="insertTable()" title="Inserisci tabella">
                    üìä
                </button>
            </div>

            <div class="toolbar-group">
                <button class="tool-btn" onclick="showFindReplace()" title="Trova e sostituisci">
                    üîç
                </button>
                <button class="tool-btn" onclick="showTemplates()" title="Modelli documento">
                    üìë
                </button>
                <button class="tool-btn" onclick="copyText()" title="Copia tutto">
                    üìã
                </button>
                <button class="tool-btn" onclick="clearFormatting()" title="Rimuovi formattazione">
                    üßπ
                </button>
            </div>
        </div>

        <!-- Barra Trova e Sostituisci -->
        <div class="find-replace-bar" id="findReplaceBar">
            <div class="find-controls">
                <input type="text" class="find-input" id="findText" placeholder="Trova...">
                <input type="text" class="find-input" id="replaceText" placeholder="Sostituisci con...">
                <div class="find-buttons">
                    <button class="btn" onclick="findNext()">Trova</button>
                    <button class="btn" onclick="replaceOne()">Sostituisci</button>
                    <button class="btn" onclick="replaceAll()">Tutto</button>
                </div>
                <span id="findResults"></span>
                <button class="btn secondary" onclick="closeFindReplace()">‚úï</button>
            </div>
        </div>

        <div class="editor-container">
            <div class="page">
                <div class="editor" 
                     id="editor" 
                     contenteditable="true" 
                     placeholder="Inizia a scrivere il tuo documento..."
                     oninput="updateWordCount()"
                     onkeyup="updateWordCount()">
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="word-count">
                <span id="wordCount">Parole: 0</span>
                <span id="charCount">Caratteri: 0</span>
                <span id="charCountNoSpaces">Caratteri (senza spazi): 0</span>
            </div>
            <div id="documentName">Documento senza titolo</div>
        </div>
    </div>

    <!-- Modal Nuovo Documento -->
    <div class="modal" id="newDocumentModal">
        <div class="modal-content">
            <h2>üìÑ Nuovo Documento</h2>
            <div class="form-group">
                <label class="form-label">Nome documento:</label>
                <input type="text" class="form-input" id="newDocumentName" placeholder="Il mio documento">
            </div>
            <div class="modal-buttons">
                <button class="btn secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="createNewDocument()">Crea</button>
            </div>
        </div>
    </div>

    <!-- Modal Carica Documenti -->
    <div class="modal" id="loadDocumentModal">
        <div class="modal-content">
            <h2>üìÅ I Tuoi Documenti</h2>
            <div class="documents-grid" id="documentsGrid">
                <!-- Documenti salvati appariranno qui -->
            </div>
            <div class="modal-buttons">
                <button class="btn secondary" onclick="closeModal()">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- Modal Inserisci Link -->
    <div class="modal" id="linkModal">
        <div class="modal-content">
            <h2>üîó Inserisci Link</h2>
            <div class="form-group">
                <label class="form-label">Testo del link:</label>
                <input type="text" class="form-input" id="linkText" placeholder="Clicca qui">
            </div>
            <div class="form-group">
                <label class="form-label">URL:</label>
                <input type="url" class="form-input" id="linkUrl" placeholder="https://esempio.com">
            </div>
            <div class="modal-buttons">
                <button class="btn secondary" onclick="closeModal()">Annulla</button>
                <button class="btn" onclick="createLink()">Inserisci</button>
            </div>
        </div>
    </div>

    <!-- Modal Modelli -->
    <div class="modal" id="templatesModal">
        <div class="modal-content">
            <h2>üìë Modelli di Documento</h2>
            <div class="documents-grid">
                <div class="template-card" onclick="useTemplate('letter')">
                    <div class="template-icon">‚úâÔ∏è</div>
                    <div class="template-name">Lettera Formale</div>
                    <div class="template-description">Modello per lettere ufficiali</div>
                </div>
                <div class="template-card" onclick="useTemplate('cv')">
                    <div class="template-icon">üìÑ</div>
                    <div class="template-name">Curriculum Vitae</div>
                    <div class="template-description">CV professionale</div>
                </div>
                <div class="template-card" onclick="useTemplate('report')">
                    <div class="template-icon">üìä</div>
                    <div class="template-name">Relazione</div>
                    <div class="template-description">Report aziendale</div>
                </div>
                <div class="template-card" onclick="useTemplate('article')">
                    <div class="template-icon">üì∞</div>
                    <div class="template-name">Articolo</div>
                    <div class="template-description">Articolo o blog post</div>
                </div>
                <div class="template-card" onclick="useTemplate('meeting')">
                    <div class="template-icon">üìù</div>
                    <div class="template-name">Verbale Riunione</div>
                    <div class="template-description">Resoconto meeting</div>
                </div>
                <div class="template-card" onclick="useTemplate('proposal')">
                    <div class="template-icon">üíº</div>
                    <div class="template-name">Proposta</div>
                    <div class="template-description">Proposta commerciale</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn secondary" onclick="closeModal()">Chiudi</button>
            </div>
        </div>
    </div>

    <script>
        class TextEditor {
            constructor() {
                this.currentDocumentName = 'Documento senza titolo';
                this.documents = this.loadFromStorage();
                this.editor = document.getElementById('editor');
                this.findResults = [];
                this.currentFindIndex = -1;
                this.init();
            }

            init() {
                this.updateWordCount();
                this.setupEditor();
                
                // Placeholder personalizzato
                this.editor.addEventListener('focus', () => {
                    if (this.editor.innerHTML === '') {
                        this.editor.innerHTML = '';
                    }
                });

                this.editor.addEventListener('blur', () => {
                    if (this.editor.innerHTML.trim() === '') {
                        this.editor.innerHTML = '';
                    }
                });
            }

            setupEditor() {
                // Auto-save ogni 30 secondi
                setInterval(() => {
                    if (this.editor.innerHTML.trim() !== '') {
                        this.autoSave();
                    }
                }, 30000);

                // Gestione tasti rapidi
                this.editor.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'b':
                                e.preventDefault();
                                this.formatText('bold');
                                break;
                            case 'i':
                                e.preventDefault();
                                this.formatText('italic');
                                break;
                            case 'u':
                                e.preventDefault();
                                this.formatText('underline');
                                break;
                            case 's':
                                e.preventDefault();
                                this.saveDocument();
                                break;
                            case 'f':
                                e.preventDefault();
                                this.showFindReplace();
                                break;
                        }
                    }
                });
            }

            formatText(command, value = null) {
                document.execCommand(command, false, value);
                this.editor.focus();
                this.updateWordCount();
            }

            changeFont() {
                const font = document.getElementById('fontFamily').value;
                this.formatText('fontName', font);
            }

            changeFontSize() {
                const size = document.getElementById('fontSize').value;
                this.formatText('fontSize', size);
            }

            changeTextColor() {
                const color = document.getElementById('textColor').value;
                this.formatText('foreColor', color);
            }

            changeBackgroundColor() {
                const color = document.getElementById('bgColor').value;
                this.formatText('backColor', color);
            }

            insertHeading(level) {
                this.formatText('formatBlock', `h${level}`);
            }

            insertQuote() {
                this.formatText('formatBlock', 'blockquote');
            }

            insertLink() {
                // Salva la selezione corrente
                this.savedSelection = this.saveSelection();
                const selectedText = window.getSelection().toString();
                
                document.getElementById('linkText').value = selectedText || '';
                document.getElementById('linkModal').classList.add('show');
                document.getElementById('linkText').focus();
            }

            createLink() {
                const text = document.getElementById('linkText').value;
                const url = document.getElementById('linkUrl').value;
                
                if (text && url) {
                    // Ripristina la selezione se esiste
                    if (this.savedSelection) {
                        this.restoreSelection(this.savedSelection);
                    }
                    
                    // Se c'era del testo selezionato, lo sostituisce con il link
                    if (window.getSelection().toString()) {
                        const link = `<a href="${url}" target="_blank">${text}</a>`;
                        this.formatText('insertHTML', link);
                    } else {
                        // Altrimenti inserisce il link nella posizione del cursore
                        const link = `<a href="${url}" target="_blank">${text}</a>`;
                        this.formatText('insertHTML', link);
                    }
                }
                
                this.closeModal();
                document.getElementById('linkText').value = '';
                document.getElementById('linkUrl').value = '';
                this.savedSelection = null;
            }

            saveSelection() {
                if (window.getSelection) {
                    const sel = window.getSelection();
                    if (sel.getRangeAt && sel.rangeCount) {
                        return sel.getRangeAt(0);
                    }
                }
                return null;
            }

            restoreSelection(range) {
                if (range) {
                    if (window.getSelection) {
                        const sel = window.getSelection();
                        sel.removeAllRanges();
                        sel.addRange(range);
                    }
                }
            }

            insertImage() {
                const url = prompt('Inserisci l\'URL dell\'immagine:');
                if (url) {
                    const img = `<img src="${url}" style="max-width: 100%; height: auto; margin: 10px 0;" alt="Immagine">`;
                    this.formatText('insertHTML', img);
                }
            }

            insertTable() {
                const rows = prompt('Numero di righe:', '3');
                const cols = prompt('Numero di colonne:', '3');
                
                if (rows && cols) {
                    let table = '<table border="1" style="border-collapse: collapse; width: 100%; margin: 10px 0;">';
                    
                    for (let i = 0; i < parseInt(rows); i++) {
                        table += '<tr>';
                        for (let j = 0; j < parseInt(cols); j++) {
                            table += '<td style="padding: 8px; border: 1px solid #ddd;">Cella</td>';
                        }
                        table += '</tr>';
                    }
                    
                    table += '</table>';
                    this.formatText('insertHTML', table);
                }
            }

            // Nuove funzioni avanzate
            showFindReplace() {
                const bar = document.getElementById('findReplaceBar');
                bar.classList.add('show');
                document.getElementById('findText').focus();
            }

            closeFindReplace() {
                document.getElementById('findReplaceBar').classList.remove('show');
                this.clearHighlights();
            }

            findNext() {
                const searchText = document.getElementById('findText').value;
                if (!searchText) return;

                this.clearHighlights();
                const content = this.editor.innerHTML;
                const regex = new RegExp(searchText, 'gi');
                let match;
                this.findResults = [];

                while ((match = regex.exec(this.editor.innerText)) !== null) {
                    this.findResults.push(match.index);
                }

                if (this.findResults.length > 0) {
                    this.currentFindIndex = (this.currentFindIndex + 1) % this.findResults.length;
                    this.highlightText(searchText);
                    document.getElementById('findResults').textContent = 
                        `${this.currentFindIndex + 1} di ${this.findResults.length}`;
                } else {
                    document.getElementById('findResults').textContent = 'Nessun risultato';
                }
            }

            highlightText(searchText) {
                const content = this.editor.innerHTML;
                const highlightedContent = content.replace(
                    new RegExp(`(${searchText})`, 'gi'),
                    '<span class="highlight">$1</span>'
                );
                this.editor.innerHTML = highlightedContent;
            }

            clearHighlights() {
                const highlights = this.editor.querySelectorAll('.highlight, .current-highlight');
                highlights.forEach(highlight => {
                    const parent = highlight.parentNode;
                    parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                    parent.normalize();
                });
            }

            replaceOne() {
                const findText = document.getElementById('findText').value;
                const replaceText = document.getElementById('replaceText').value;
                
                if (!findText) return;

                const content = this.editor.innerHTML;
                const newContent = content.replace(new RegExp(findText, 'i'), replaceText);
                this.editor.innerHTML = newContent;
                this.showNotification('‚úÖ Testo sostituito!');
            }

            replaceAll() {
                const findText = document.getElementById('findText').value;
                const replaceText = document.getElementById('replaceText').value;
                
                if (!findText) return;

                const content = this.editor.innerHTML;
                const newContent = content.replace(new RegExp(findText, 'gi'), replaceText);
                this.editor.innerHTML = newContent;
                this.showNotification('‚úÖ Tutte le occorrenze sostituite!');
            }

            showTemplates() {
                document.getElementById('templatesModal').classList.add('show');
            }

            useTemplate(templateType) {
                const templates = {
                    letter: `
                        <div style="text-align: right; margin-bottom: 40px;">
                            <div>[Il tuo nome]</div>
                            <div>[Il tuo indirizzo]</div>
                            <div>[Citt√†, CAP]</div>
                            <div>[Email]</div>
                            <div>[Telefono]</div>
                            <br>
                            <div>[Data]</div>
                        </div>
                        
                        <div style="margin-bottom: 40px;">
                            <div>[Nome destinatario]</div>
                            <div>[Indirizzo destinatario]</div>
                            <div>[Citt√†, CAP]</div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <strong>Oggetto: [Oggetto della lettera]</strong>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            Gentile [Sig./Sig.ra Cognome],
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            [Corpo della lettera]
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            La ringrazio per l'attenzione e rimango a disposizione per ulteriori chiarimenti.
                        </div>
                        
                        <div>
                            Cordiali saluti,<br><br>
                            [La tua firma]
                        </div>
                    `,
                    cv: `
                        <h1 style="text-align: center; color: #333;">[Il tuo nome]</h1>
                        <div style="text-align: center; margin-bottom: 30px;">
                            [Email] ‚Ä¢ [Telefono] ‚Ä¢ [Citt√†] ‚Ä¢ [LinkedIn]
                        </div>
                        
                        <h2>Profilo Professionale</h2>
                        <p>[Breve descrizione delle tue competenze e obiettivi professionali]</p>
                        
                        <h2>Esperienza Lavorativa</h2>
                        <div style="margin-bottom: 20px;">
                            <strong>[Posizione] - [Azienda]</strong><br>
                            <em>[Date di impiego]</em>
                            <ul>
                                <li>[Responsabilit√† principale]</li>
                                <li>[Risultato ottenuto]</li>
                                <li>[Competenza sviluppata]</li>
                            </ul>
                        </div>
                        
                        <h2>Formazione</h2>
                        <div style="margin-bottom: 20px;">
                            <strong>[Titolo di studio] - [Istituto]</strong><br>
                            <em>[Anno di conseguimento]</em>
                        </div>
                        
                        <h2>Competenze</h2>
                        <ul>
                            <li>[Competenza tecnica]</li>
                            <li>[Competenza linguistica]</li>
                            <li>[Competenza trasversale]</li>
                        </ul>
                    `,
                    report: `
                        <h1 style="text-align: center;">RELAZIONE</h1>
                        <h2 style="text-align: center;">[Titolo del Report]</h2>
                        
                        <div style="margin: 30px 0;">
                            <strong>Data:</strong> [Data]<br>
                            <strong>Autore:</strong> [Nome]<br>
                            <strong>Destinatario:</strong> [Destinatario]
                        </div>
                        
                        <h2>1. Sommario Esecutivo</h2>
                        <p>[Breve riassunto dei punti principali e delle conclusioni]</p>
                        
                        <h2>2. Introduzione</h2>
                        <p>[Contesto e obiettivi del report]</p>
                        
                        <h2>3. Metodologia</h2>
                        <p>[Come sono stati raccolti e analizzati i dati]</p>
                        
                        <h2>4. Risultati</h2>
                        <p>[Presentazione dei dati e delle scoperte principali]</p>
                        
                        <h2>5. Conclusioni</h2>
                        <p>[Interpretazione dei risultati e implicazioni]</p>
                        
                        <h2>6. Raccomandazioni</h2>
                        <ul>
                            <li>[Raccomandazione 1]</li>
                            <li>[Raccomandazione 2]</li>
                            <li>[Raccomandazione 3]</li>
                        </ul>
                    `,
                    article: `
                        <h1>[Titolo dell'Articolo]</h1>
                        <div style="margin-bottom: 30px; color: #666;">
                            <em>Di [Autore] - [Data]</em>
                        </div>
                        
                        <p style="font-size: 18px; font-style: italic; margin-bottom: 30px;">
                            [Sottotitolo o breve introduzione che cattura l'attenzione del lettore]
                        </p>
                        
                        <h2>Introduzione</h2>
                        <p>[Paragrafo introduttivo che presenta l'argomento e il contesto]</p>
                        
                        <h2>[Sottotitolo Sezione 1]</h2>
                        <p>[Contenuto della prima sezione principale]</p>
                        
                        <h2>[Sottotitolo Sezione 2]</h2>
                        <p>[Contenuto della seconda sezione principale]</p>
                        
                        <h2>Conclusioni</h2>
                        <p>[Riassunto dei punti principali e riflessioni finali]</p>
                        
                        <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-left: 4px solid #667eea;">
                            <strong>Nota dell'autore:</strong> [Eventuali note aggiuntive o ringraziamenti]
                        </div>
                    `,
                    meeting: `
                        <h1 style="text-align: center;">VERBALE DI RIUNIONE</h1>
                        
                        <div style="margin: 30px 0;">
                            <strong>Data:</strong> [Data]<br>
                            <strong>Ora:</strong> [Ora inizio] - [Ora fine]<br>
                            <strong>Luogo:</strong> [Luogo/Piattaforma]<br>
                            <strong>Moderatore:</strong> [Nome]<br>
                            <strong>Segretario:</strong> [Nome]
                        </div>
                        
                        <h2>Partecipanti</h2>
                        <ul>
                            <li>[Nome 1] - [Ruolo]</li>
                            <li>[Nome 2] - [Ruolo]</li>
                            <li>[Nome 3] - [Ruolo]</li>
                        </ul>
                        
                        <h2>Ordine del Giorno</h2>
                        <ol>
                            <li>[Argomento 1]</li>
                            <li>[Argomento 2]</li>
                            <li>[Argomento 3]</li>
                        </ol>
                        
                        <h2>Discussioni e Decisioni</h2>
                        <h3>[Argomento 1]</h3>
                        <p><strong>Discussione:</strong> [Riassunto della discussione]</p>
                        <p><strong>Decisione:</strong> [Decisione presa]</p>
                        <p><strong>Azione:</strong> [Chi fa cosa entro quando]</p>
                        
                        <h2>Azioni da Intraprendere</h2>
                        <table border="1" style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <th style="padding: 8px;">Azione</th>
                                <th style="padding: 8px;">Responsabile</th>
                                <th style="padding: 8px;">Scadenza</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px;">[Azione 1]</td>
                                <td style="padding: 8px;">[Nome]</td>
                                <td style="padding: 8px;">[Data]</td>
                            </tr>
                        </table>
                        
                        <h2>Prossima Riunione</h2>
                        <p><strong>Data:</strong> [Data]<br>
                        <strong>Argomenti:</strong> [Argomenti da trattare]</p>
                    `,
                    proposal: `
                        <h1 style="text-align: center;">PROPOSTA COMMERCIALE</h1>
                        
                        <div style="margin: 30px 0;">
                            <strong>A:</strong> [Nome Cliente/Azienda]<br>
                            <strong>Da:</strong> [Il tuo nome/Azienda]<br>
                            <strong>Data:</strong> [Data]<br>
                            <strong>Oggetto:</strong> [Oggetto della proposta]
                        </div>
                        
                        <h2>Sommario Esecutivo</h2>
                        <p>[Breve descrizione della proposta e dei benefici principali]</p>
                        
                        <h2>Analisi delle Esigenze</h2>
                        <p>[Descrizione delle esigenze del cliente che hai identificato]</p>
                        
                        <h2>Soluzione Proposta</h2>
                        <p>[Descrizione dettagliata della tua soluzione]</p>
                        
                        <h3>Caratteristiche Principali:</h3>
                        <ul>
                            <li>[Caratteristica 1]</li>
                            <li>[Caratteristica 2]</li>
                            <li>[Caratteristica 3]</li>
                        </ul>
                        
                        <h2>Benefici</h2>
                        <ul>
                            <li>[Beneficio 1]</li>
                            <li>[Beneficio 2]</li>
                            <li>[Beneficio 3]</li>
                        </ul>
                        
                        <h2>Investimento</h2>
                        <table border="1" style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <th style="padding: 8px;">Descrizione</th>
                                <th style="padding: 8px;">Quantit√†</th>
                                <th style="padding: 8px;">Prezzo Unitario</th>
                                <th style="padding: 8px;">Totale</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px;">[Servizio/Prodotto]</td>
                                <td style="padding: 8px;">[Qty]</td>
                                <td style="padding: 8px;">[Prezzo]</td>
                                <td style="padding: 8px;">[Totale]</td>
                            </tr>
                        </table>
                        
                        <h2>Tempistiche</h2>
                        <p>[Cronologia del progetto e milestone principali]</p>
                        
                        <h2>Prossimi Passi</h2>
                        <p>[Cosa succede se il cliente accetta la proposta]</p>
                        
                        <div style="margin-top: 40px;">
                            <p>Grazie per aver considerato la nostra proposta. Rimaniamo a disposizione per qualsiasi chiarimento.</p>
                            <br>
                            <p>[La tua firma]<br>
                            [Nome e titolo]<br>
                            [Contatti]</p>
                        </div>
                    `
                };

                if (templates[templateType]) {
                    this.editor.innerHTML = templates[templateType];
                    this.updateWordCount();
                    this.closeModal();
                    this.showNotification('üìë Modello caricato!');
                }
            }

            copyText() {
                const text = this.editor.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    this.showNotification('üìã Testo copiato negli appunti!');
                }).catch(() => {
                    // Fallback per browser pi√π vecchi
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.showNotification('üìã Testo copiato negli appunti!');
                });
            }

            clearFormatting() {
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    const contents = range.extractContents();
                    const textContent = contents.textContent;
                    range.insertNode(document.createTextNode(textContent));
                    this.showNotification('üßπ Formattazione rimossa!');
                } else {
                    this.showNotification('‚ö†Ô∏è Seleziona del testo prima!');
                }
            }

            updateWordCount() {
                const text = this.editor.innerText || this.editor.textContent || '';
                const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
                const chars = text.length;
                const charsNoSpaces = text.replace(/\s/g, '').length;

                document.getElementById('wordCount').textContent = `Parole: ${words}`;
                document.getElementById('charCount').textContent = `Caratteri: ${chars}`;
                document.getElementById('charCountNoSpaces').textContent = `Caratteri (senza spazi): ${charsNoSpaces}`;
            }

            newDocument() {
                if (this.editor.innerHTML.trim() !== '') {
                    if (!confirm('Vuoi creare un nuovo documento? Le modifiche non salvate andranno perse.')) {
                        return;
                    }
                }
                
                document.getElementById('newDocumentModal').classList.add('show');
                document.getElementById('newDocumentName').focus();
            }

            createNewDocument() {
                const name = document.getElementById('newDocumentName').value.trim() || 'Documento senza titolo';
                
                this.currentDocumentName = name;
                this.editor.innerHTML = '';
                this.updateDocumentName();
                this.updateWordCount();
                this.closeModal();
                
                document.getElementById('newDocumentName').value = '';
                this.editor.focus();
            }

            saveDocument() {
                const content = this.editor.innerHTML;
                const preview = this.editor.innerText.substring(0, 100) + '...';
                
                this.documents[this.currentDocumentName] = {
                    content: content,
                    preview: preview,
                    date: new Date().toLocaleString('it-IT'),
                    wordCount: this.editor.innerText.trim().split(/\s+/).length
                };
                
                this.saveToStorage();
                this.showNotification('‚úÖ Documento salvato!');
            }

            autoSave() {
                this.saveDocument();
                this.showNotification('üíæ Salvataggio automatico', 1000);
            }

            loadDocuments() {
                this.updateDocumentsGrid();
                document.getElementById('loadDocumentModal').classList.add('show');
            }

            loadDocument(name) {
                if (this.documents[name]) {
                    this.currentDocumentName = name;
                    this.editor.innerHTML = this.documents[name].content;
                    this.updateDocumentName();
                    this.updateWordCount();
                    this.closeModal();
                    this.editor.focus();
                }
            }

            deleteDocument(name) {
                if (confirm(`Eliminare definitivamente "${name}"?`)) {
                    delete this.documents[name];
                    this.saveToStorage();
                    this.updateDocumentsGrid();
                    
                    if (this.currentDocumentName === name) {
                        this.currentDocumentName = 'Documento senza titolo';
                        this.editor.innerHTML = '';
                        this.updateDocumentName();
                        this.updateWordCount();
                    }
                }
            }

            exportDocument() {
                const content = this.editor.innerHTML;
                const blob = new Blob([`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>${this.currentDocumentName}</title>
                        <style>
                            body { font-family: 'Times New Roman', serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 40px; }
                            h1, h2, h3 { color: #333; }
                            blockquote { border-left: 4px solid #667eea; padding-left: 20px; margin: 20px 0; font-style: italic; background: #f8f9fa; padding: 15px; }
                            table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                            td, th { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            img { max-width: 100%; height: auto; }
                        </style>
                    </head>
                    <body>
                        ${content}
                    </body>
                    </html>
                `], { type: 'text/html' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.currentDocumentName}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('üì§ Documento esportato!');
            }

            printDocument() {
                const content = this.editor.innerHTML;
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${this.currentDocumentName}</title>
                        <style>
                            body { font-family: 'Times New Roman', serif; line-height: 1.6; margin: 40px; }
                            h1, h2, h3 { color: #333; }
                            blockquote { border-left: 4px solid #667eea; padding-left: 20px; margin: 20px 0; font-style: italic; }
                            table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                            td, th { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            img { max-width: 100%; height: auto; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>
                        ${content}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }

            updateDocumentsGrid() {
                const grid = document.getElementById('documentsGrid');
                grid.innerHTML = '';

                const docNames = Object.keys(this.documents);
                
                if (docNames.length === 0) {
                    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #6c757d; padding: 40px;">Nessun documento salvato</div>';
                    return;
                }

                docNames.forEach(name => {
                    const doc = this.documents[name];
                    const card = document.createElement('div');
                    card.className = 'document-card';
                    card.onclick = () => this.loadDocument(name);
                    card.innerHTML = `
                        <button class="document-delete" onclick="event.stopPropagation(); editor.deleteDocument('${name}')">√ó</button>
                        <div class="document-name">${name}</div>
                        <div class="document-preview">${doc.preview}</div>
                        <div class="document-date">${doc.date} ‚Ä¢ ${doc.wordCount || 0} parole</div>
                    `;
                    grid.appendChild(card);
                });
            }

            updateDocumentName() {
                document.getElementById('documentName').textContent = this.currentDocumentName;
            }

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('textEditor_documents');
                    return saved ? JSON.parse(saved) : {};
                } catch (error) {
                    console.error('Errore nel caricamento:', error);
                    return {};
                }
            }

            saveToStorage() {
                try {
                    localStorage.setItem('textEditor_documents', JSON.stringify(this.documents));
                } catch (error) {
                    console.error('Errore nel salvataggio:', error);
                }
            }

            showNotification(message, duration = 2000) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #667eea;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    font-weight: 600;
                    z-index: 10000;
                    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                    style.remove();
                }, duration);
            }

            closeModal() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        }

        // Funzioni globali
        function formatText(command, value) { editor.formatText(command, value); }
        function changeFont() { editor.changeFont(); }
        function changeFontSize() { editor.changeFontSize(); }
        function changeTextColor() { editor.changeTextColor(); }
        function changeBackgroundColor() { editor.changeBackgroundColor(); }
        function insertHeading(level) { editor.insertHeading(level); }
        function insertQuote() { editor.insertQuote(); }
        function insertLink() { editor.insertLink(); }
        function createLink() { editor.createLink(); }
        function insertImage() { editor.insertImage(); }
        function insertTable() { editor.insertTable(); }
        function newDocument() { editor.newDocument(); }
        function createNewDocument() { editor.createNewDocument(); }
        function saveDocument() { editor.saveDocument(); }
        function loadDocuments() { editor.loadDocuments(); }
        function exportDocument() { editor.exportDocument(); }
        function printDocument() { editor.printDocument(); }
        function updateWordCount() { editor.updateWordCount(); }
        function closeModal() { editor.closeModal(); }

        // Nuove funzioni
        function showFindReplace() { editor.showFindReplace(); }
        function closeFindReplace() { editor.closeFindReplace(); }
        function findNext() { editor.findNext(); }
        function replaceOne() { editor.replaceOne(); }
        function replaceAll() { editor.replaceAll(); }
        function showTemplates() { editor.showTemplates(); }
        function useTemplate(type) { editor.useTemplate(type); }
        function copyText() { editor.copyText(); }
        function clearFormatting() { editor.clearFormatting(); }

        // Event listeners
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // Inizializza editor
        const editor = new TextEditor();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d82e1c03aded4b',t:'MTc1NzYwNDM1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
